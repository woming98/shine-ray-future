import{c as N,r as o,j as e,F as k}from"./index-BMvr2Q3z.js";import{C as y,B as j}from"./Button-pqDR0Cbl.js";import{P as $}from"./pause-BomaQ2dm.js";import{P as z}from"./play-BIQoX-S_.js";import{V as B}from"./volume-2-V3PI-oVv.js";import{E as L}from"./eye-off-BFWwfAfH.js";import{E as R}from"./eye-CHDnctu0.js";import{S as v}from"./save-CUan6tCV.js";import{u as D}from"./useStore-BLrCrgBZ.js";import{H as _}from"./index-ma8y2xMM.js";import"./middleware-dtXbDlhF.js";import"./useGlobalUser-DSzfZyT8.js";import"./arrow-left-Op4CMYGn.js";import"./pen-tool-aHdskOzV.js";import"./award-CFhIG7Jo.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=N("Highlighter",[["path",{d:"m9 11-6 6v3h9l3-3",key:"1a3l36"}],["path",{d:"m22 12-4.6 4.6a2 2 0 0 1-2.8 0l-5.2-5.2a2 2 0 0 1 0-2.8L14 4",key:"14a9rk"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=N("SkipBack",[["polygon",{points:"19 20 9 12 19 4 19 20",key:"o2sva"}],["line",{x1:"5",x2:"5",y1:"19",y2:"5",key:"1ocqjk"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A=N("SkipForward",[["polygon",{points:"5 4 15 12 5 20 5 4",key:"16p6eg"}],["line",{x1:"19",x2:"19",y1:"5",y2:"19",key:"futhcm"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=N("VolumeX",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]),O=[{id:"listening-001",title:"School Announcement",audioUrl:"/audio/listening-001.mp3",transcript:`
Good morning, students. This is a school announcement. 
Today's lunch menu includes chicken rice, fish and chips, and vegetarian pasta. 
The school library will be closed this afternoon for maintenance. 
Please remember to return your library books before 3 PM.
    `.trim(),difficulty:"easy",duration:60,dataFile:{id:"df-001",title:"Lunch Menu",type:"table",content:{headers:["Item","Price"],rows:[["Chicken Rice","$25"],["Fish and Chips","$30"],["Vegetarian Pasta","$28"]]},description:"Today's lunch menu"}},{id:"listening-002",title:"Weather Forecast",audioUrl:"/audio/listening-002.mp3",transcript:`
The weather forecast for today shows sunny skies in the morning with temperatures around 25 degrees Celsius. 
In the afternoon, there will be light clouds, but no rain is expected. 
Tomorrow will be slightly cooler with a chance of afternoon showers.
    `.trim(),difficulty:"medium",duration:45}],Q=[{id:"lq-001",materialId:"listening-001",type:"choice",question:"What time should students return library books?",options:["Before 2 PM","Before 3 PM","Before 4 PM","Before 5 PM"],answer:"Before 3 PM",explanation:'The announcement states "Please remember to return your library books before 3 PM."',difficulty:"easy",timestamp:50},{id:"lq-002",materialId:"listening-001",type:"fill",question:"The school library will be closed this afternoon for _______.",answer:["maintenance"],explanation:'The announcement mentions "The school library will be closed this afternoon for maintenance."',difficulty:"easy",timestamp:30}];function W({audioUrl:a,onTimeUpdate:r}){const[n,m]=o.useState(!1),[p,x]=o.useState(0),[i,c]=o.useState(0),[s,d]=o.useState(1),[h,g]=o.useState(!1),[C,S]=o.useState(1),f=o.useRef(null);o.useEffect(()=>{const t=f.current;if(!t)return;const l=()=>{x(t.currentTime),r==null||r(t.currentTime)},u=()=>{c(t.duration)};return t.addEventListener("timeupdate",l),t.addEventListener("loadedmetadata",u),()=>{t.removeEventListener("timeupdate",l),t.removeEventListener("loadedmetadata",u)}},[r]);const P=()=>{const t=f.current;t&&(n?t.pause():t.play(),m(!n))},M=t=>{const l=f.current;if(!l)return;const u=parseFloat(t.target.value);l.currentTime=u,x(u)},b=t=>{const l=f.current;l&&(l.currentTime=Math.max(0,Math.min(i,l.currentTime+t)))},T=t=>{const l=f.current;if(!l)return;const u=parseFloat(t.target.value);l.volume=u,d(u),g(u===0)},E=()=>{const t=f.current;t&&(h?(t.volume=s||.5,g(!1)):(t.volume=0,g(!0)))},V=t=>{const l=f.current;l&&(l.playbackRate=t,S(t))},w=t=>{const l=Math.floor(t/60),u=Math.floor(t%60);return`${l.toString().padStart(2,"0")}:${u.toString().padStart(2,"0")}`};return e.jsxs(y,{className:"p-6",children:[e.jsx("audio",{ref:f,src:a}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("input",{type:"range",min:"0",max:i||0,value:p,onChange:M,className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-emerald-500"}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-600 mt-1",children:[e.jsx("span",{children:w(p)}),e.jsx("span",{children:w(i)})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{variant:"secondary",size:"sm",onClick:()=>b(-10),icon:e.jsx(H,{className:"w-4 h-4"}),children:"-10s"}),e.jsx(j,{size:"lg",onClick:P,icon:n?e.jsx($,{className:"w-5 h-5"}):e.jsx(z,{className:"w-5 h-5"}),children:n?"暂停":"播放"}),e.jsx(j,{variant:"secondary",size:"sm",onClick:()=>b(10),icon:e.jsx(A,{className:"w-4 h-4"}),children:"+10s"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"速度："}),[.5,.75,1,1.25,1.5].map(t=>e.jsxs("button",{onClick:()=>V(t),className:`px-2 py-1 rounded text-sm ${C===t?"bg-emerald-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[t,"x"]},t))]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:E,children:h?e.jsx(F,{className:"w-5 h-5 text-gray-600"}):e.jsx(B,{className:"w-5 h-5 text-gray-600"})}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:h?0:s,onChange:T,className:"w-20 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-emerald-500"})]})]})]})]})}function X({dataFile:a,onSelect:r}){const[n,m]=o.useState(new Set),p=(i,c)=>{const s=`${i}-${c}`,d=new Set(n);d.has(s)?d.delete(s):d.add(s),m(d)},x=()=>a.type==="table"&&a.content.headers&&a.content.rows?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsx("tr",{className:"bg-emerald-50",children:a.content.headers.map((i,c)=>e.jsx("th",{className:"border border-emerald-200 px-4 py-2 text-left font-medium text-gray-900",children:i},c))})}),e.jsx("tbody",{children:a.content.rows.map((i,c)=>e.jsx("tr",{className:"hover:bg-emerald-50/50",children:i.map((s,d)=>{const h=`${c}-${d}`,g=n.has(h);return e.jsx("td",{onClick:()=>p(c,d),className:`border border-emerald-200 px-4 py-2 cursor-pointer transition-colors ${g?"bg-yellow-200":""}`,children:s},d)})},c))})]})}):a.type==="text"?e.jsx("div",{className:"prose prose-emerald max-w-none",children:e.jsx("p",{className:"text-gray-800 whitespace-pre-wrap",children:a.content})}):e.jsxs("div",{className:"text-gray-600",children:[e.jsxs("p",{children:["数据格式：",a.type]}),e.jsx("pre",{className:"bg-gray-50 p-4 rounded overflow-x-auto",children:JSON.stringify(a.content,null,2)})]});return e.jsxs(y,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"w-5 h-5 text-emerald-600"}),e.jsx("h3",{className:"font-bold text-gray-900",children:a.title})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(j,{variant:"secondary",size:"sm",icon:e.jsx(I,{className:"w-4 h-4"}),onClick:()=>{const i=Array.from(n).map(c=>{var h;const[s,d]=c.split("-").map(Number);return a.content.rows?(h=a.content.rows[s])==null?void 0:h[d]:null});r==null||r(i)},children:["导出选中 (",n.size,")"]})})]}),a.description&&e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:a.description}),x()]})}function G({transcript:a}){const[r,n]=o.useState(!1);return e.jsxs(y,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-bold text-gray-900",children:"文本稿"}),e.jsx(j,{variant:"secondary",size:"sm",onClick:()=>n(!r),icon:r?e.jsx(L,{className:"w-4 h-4"}):e.jsx(R,{className:"w-4 h-4"}),children:r?"隐藏":"显示"})]}),r&&e.jsx("div",{className:"prose prose-emerald max-w-none",children:e.jsx("p",{className:"text-gray-800 leading-relaxed whitespace-pre-wrap",children:a})})]})}function J({initialNotes:a="",onSave:r,autoSave:n=!0}){const[m,p]=o.useState(a),[x,i]=o.useState(!1);o.useEffect(()=>{if(n&&m!==a){const s=setTimeout(()=>{i(!0),r==null||r(m),setTimeout(()=>i(!1),500)},1e3);return()=>clearTimeout(s)}},[m,n,r,a]);const c=()=>{i(!0),r==null||r(m),setTimeout(()=>i(!1),500)};return e.jsxs(y,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"w-5 h-5 text-emerald-600"}),e.jsx("h3",{className:"font-bold text-gray-900",children:"笔记"})]}),!n&&e.jsx(j,{size:"sm",onClick:c,disabled:x,icon:e.jsx(v,{className:"w-4 h-4"}),children:x?"保存中...":"保存"}),n&&x&&e.jsxs("span",{className:"text-sm text-emerald-600 flex items-center gap-1",children:[e.jsx(v,{className:"w-4 h-4"}),"自动保存中..."]})]}),e.jsx("textarea",{value:m,onChange:s=>p(s.target.value),placeholder:"在这里记录你的笔记...",className:"w-full h-48 p-4 border-2 border-gray-200 rounded-lg focus:border-emerald-500 focus:outline-none resize-none text-gray-900 placeholder-gray-400"})]})}function de(){const[a,r]=o.useState(null),[n,m]=o.useState(""),{recordDailyStudy:p}=D(),x=s=>{r(s),m("")},i=s=>{m(s),p({minutes:10,exercisesCompleted:0,skillsStudied:["listening"]})};if(!a)return e.jsx("div",{className:"space-y-6",children:e.jsxs(y,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(_,{className:"w-6 h-6 text-emerald-600"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"听力训练"})]}),e.jsx("p",{className:"text-gray-600 mb-6",children:"选择一个听力材料开始练习。支持音频播放、Data File 处理、文本稿查看和笔记功能。"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:O.map(s=>e.jsxs(y,{onClick:()=>x(s),className:"cursor-pointer hover:shadow-md transition-shadow",children:[e.jsx("h3",{className:"font-bold text-gray-900 mb-2",children:s.title}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("span",{children:["难度：",s.difficulty]}),e.jsxs("span",{children:["时长：",Math.floor(s.duration/60)," 分钟"]})]}),s.dataFile&&e.jsx("div",{className:"mt-2 text-sm text-emerald-600",children:"包含 Data File"})]},s.id))})]})});const c=Q.filter(s=>s.materialId===a.id);return e.jsx("div",{className:"space-y-6",children:e.jsxs(y,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:a.title}),e.jsx(j,{variant:"secondary",onClick:()=>r(null),children:"返回列表"})]}),e.jsx("div",{className:"mb-6",children:e.jsx(W,{audioUrl:a.audioUrl})}),a.dataFile&&e.jsx("div",{className:"mb-6",children:e.jsx(X,{dataFile:a.dataFile})}),e.jsx("div",{className:"mb-6",children:e.jsx(G,{transcript:a.transcript})}),e.jsx("div",{className:"mb-6",children:e.jsx(J,{initialNotes:n,onSave:i,autoSave:!0})}),c.length>0&&e.jsxs(y,{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"听力题目"}),e.jsx("div",{className:"space-y-4",children:c.map(s=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsx("p",{className:"font-medium text-gray-900 mb-3",children:s.question}),s.options&&e.jsx("div",{className:"space-y-2",children:s.options.map((d,h)=>{const g=String.fromCharCode(65+h);return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-medium text-gray-700",children:[g,"."]}),e.jsx("span",{className:"text-gray-700",children:d})]},h)})}),s.timestamp&&e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["音频时间：",Math.floor(s.timestamp/60),":",Math.floor(s.timestamp%60).toString().padStart(2,"0")]})]},s.id))})]})]})})}export{de as default};

import{r as c,j as e,F as S,m as v,T as C}from"./index-BMvr2Q3z.js";import{s as k,L as T}from"./s1-writing-q4Hg3Ok0.js";import{S as $}from"./save-CUan6tCV.js";import{C as d,B as u}from"./Button-pqDR0Cbl.js";import{C as E}from"./check-circle-C5mn4RTd.js";import{L as A}from"./lightbulb-Boxxg2Kv.js";import{A as z}from"./alert-circle-t739gKq8.js";import{u as I}from"./useStore-BLrCrgBZ.js";import{P}from"./pen-tool-aHdskOzV.js";import{R}from"./refresh-cw-BeWsOecW.js";import{S as B}from"./send-_8Oxq5Rk.js";import"./middleware-dtXbDlhF.js";import"./useGlobalUser-DSzfZyT8.js";function F({value:s,onChange:l,wordLimit:t,placeholder:a="开始写作...",autoSave:r=!0}){const[i,j]=c.useState(0),[h,g]=c.useState(!1),m=c.useRef(null);c.useEffect(()=>{const o=s.trim().split(/\s+/).filter(b=>b.length>0);j(o.length)},[s]),c.useEffect(()=>{if(r&&s){const o=setTimeout(()=>{g(!0),setTimeout(()=>g(!1),500)},1e3);return()=>clearTimeout(o)}},[s,r]);const f=o=>{l(o.target.value)},N=()=>t?i<t.min?"text-orange-600":i>t.max?"text-red-600":"text-emerald-600":"text-gray-600";return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-xl border-2 border-emerald-200 shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 bg-emerald-50 border-b border-emerald-200",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"w-4 h-4 text-emerald-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"写作编辑器"})]}),h&&e.jsxs(v.div,{initial:{opacity:0},animate:{opacity:1},className:"flex items-center gap-2 text-sm text-emerald-600",children:[e.jsx($,{className:"w-4 h-4"}),e.jsx("span",{children:"保存中..."})]})]}),e.jsx("textarea",{ref:m,value:s,onChange:f,placeholder:a,className:"w-full h-96 p-4 resize-none focus:outline-none text-gray-900 placeholder-gray-400",style:{fontFamily:"inherit"}})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{children:[e.jsxs("span",{className:`text-sm font-medium ${N()}`,children:["字数：",i]}),t&&e.jsxs("span",{className:"text-sm text-gray-500 ml-2",children:["(",t.min," - ",t.max," 字)"]})]})}),t&&e.jsx("div",{className:"flex-1 max-w-xs",children:e.jsx("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full transition-all ${i<t.min?"bg-orange-500":i>t.max?"bg-red-500":"bg-emerald-500"}`,style:{width:`${Math.min(100,i/t.max*100)}%`}})})})]})]})}function L({score:s}){const l=a=>a>=6?"text-emerald-600":a>=4?"text-yellow-600":"text-red-600",t=a=>a>=6?"bg-emerald-50 border-emerald-200":a>=4?"bg-yellow-50 border-yellow-200":"bg-red-50 border-red-200";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs(d,{className:`p-4 text-center ${t(s.content)}`,children:[e.jsx("div",{className:`text-3xl font-bold ${l(s.content)} mb-1`,children:s.content}),e.jsx("div",{className:"text-xs text-gray-600",children:"Content"}),e.jsx("div",{className:"text-xs text-gray-500",children:"内容"})]}),e.jsxs(d,{className:`p-4 text-center ${t(s.language)}`,children:[e.jsx("div",{className:`text-3xl font-bold ${l(s.language)} mb-1`,children:s.language}),e.jsx("div",{className:"text-xs text-gray-600",children:"Language"}),e.jsx("div",{className:"text-xs text-gray-500",children:"语言"})]}),e.jsxs(d,{className:`p-4 text-center ${t(s.organization)}`,children:[e.jsx("div",{className:`text-3xl font-bold ${l(s.organization)} mb-1`,children:s.organization}),e.jsx("div",{className:"text-xs text-gray-600",children:"Organization"}),e.jsx("div",{className:"text-xs text-gray-500",children:"结构"})]}),e.jsxs(d,{className:`p-4 text-center ${t(s.total/3)}`,children:[e.jsxs("div",{className:`text-3xl font-bold ${l(s.total/3)} mb-1`,children:[s.total,"/21"]}),e.jsx("div",{className:"text-xs text-gray-600",children:"Total"}),e.jsx("div",{className:"text-xs text-gray-500",children:"总分"})]})]}),s.feedback.strengths.length>0&&e.jsxs(d,{className:"p-6 bg-emerald-50 border-emerald-200",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[e.jsx(E,{className:"w-5 h-5 text-emerald-600 flex-shrink-0 mt-0.5"}),e.jsx("h3",{className:"font-bold text-emerald-900",children:"优点"})]}),e.jsx("ul",{className:"space-y-2",children:s.feedback.strengths.map((a,r)=>e.jsxs("li",{className:"text-emerald-800 text-sm flex items-start gap-2",children:[e.jsx("span",{className:"text-emerald-600 mt-1",children:"•"}),e.jsx("span",{children:a})]},r))})]}),s.feedback.improvements.length>0&&e.jsxs(d,{className:"p-6 bg-blue-50 border-blue-200",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[e.jsx(A,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),e.jsx("h3",{className:"font-bold text-blue-900",children:"改进建议"})]}),e.jsx("ul",{className:"space-y-2",children:s.feedback.improvements.map((a,r)=>e.jsxs("li",{className:"text-blue-800 text-sm flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-600 mt-1",children:"•"}),e.jsx("span",{children:a})]},r))})]}),s.feedback.correctedSentences&&s.feedback.correctedSentences.length>0&&e.jsxs(d,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[e.jsx(z,{className:"w-5 h-5 text-orange-600 flex-shrink-0 mt-0.5"}),e.jsx("h3",{className:"font-bold text-gray-900",children:"修改建议"})]}),e.jsx("div",{className:"space-y-4",children:s.feedback.correctedSentences.map((a,r)=>e.jsxs("div",{className:"border-l-4 border-orange-400 pl-4 space-y-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"原文："}),e.jsx("p",{className:"text-gray-700 line-through",children:a.original})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"修改后："}),e.jsx("p",{className:"text-emerald-700 font-medium",children:a.corrected})]})]},r))})]}),e.jsx(d,{className:"p-6 bg-gradient-to-br from-emerald-50 to-teal-50 border-emerald-200",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(C,{className:"w-5 h-5 text-emerald-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-900 mb-2",children:"总体评价"}),e.jsx("p",{className:"text-gray-700 leading-relaxed",children:s.overallComment})]})]})})]})}const W="http://localhost:3001";function Z(){const[s,l]=c.useState("selecting"),[t,a]=c.useState(null),[r,i]=c.useState(""),[j,h]=c.useState(null),[g,m]=c.useState(null),{addEssaySubmission:f,recordDailyStudy:N}=I(),o=n=>{a(n),i(""),h(null),m(null),l("writing")},b=async()=>{if(!t)return;if(r.trim().split(/\s+/).filter(x=>x.length>0).length<t.wordLimit.min){m(`作文太短，请至少写 ${t.wordLimit.min} 个单词`);return}l("evaluating"),m(null);try{const x=await fetch(`${W}/api/evaluate-writing`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:t.prompt,essay:r,wordLimit:t.wordLimit,grade:"S1"})});if(!x.ok)throw new Error("评分服务暂时不可用");const p=await x.json();h(p),l("result"),f(t.id,r,p),N({minutes:30,exercisesCompleted:1,skillsStudied:["writing"]})}catch(x){const p=x instanceof Error?x.message:"评分失败，请稍后重试";m(p),l("writing")}},w=()=>{i(""),h(null),m(null),l("writing")},y=()=>{a(null),i(""),h(null),m(null),l("selecting")};return s==="selecting"?e.jsx("div",{className:"space-y-6",children:e.jsxs(d,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(P,{className:"w-6 h-6 text-emerald-600"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"AI 写作批改"})]}),e.jsx("p",{className:"text-gray-600 mb-6",children:"选择一个写作题目开始练习。AI 将为你提供详细的批改反馈和评分。"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:k.map(n=>e.jsxs(d,{onClick:()=>o(n),className:"cursor-pointer hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h3",{className:"font-bold text-gray-900",children:n.title}),e.jsx("span",{className:"text-xs px-2 py-1 bg-emerald-100 text-emerald-700 rounded",children:n.type})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-3 line-clamp-2",children:n.prompt}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[e.jsxs("span",{children:[n.wordLimit.min," - ",n.wordLimit.max," 字"]}),e.jsxs("span",{children:[n.tips.length," 个提示"]})]})]},n.id))})]})}):s==="result"&&j?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"AI 评分结果"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(u,{variant:"secondary",onClick:w,icon:e.jsx(R,{className:"w-4 h-4"}),children:"重新写作"}),e.jsx(u,{onClick:y,children:"选择新题目"})]})]}),e.jsx(L,{score:j})]}):e.jsxs("div",{className:"space-y-6",children:[t&&e.jsxs(d,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:t.title}),e.jsx("p",{className:"text-gray-700 leading-relaxed",children:t.prompt})]}),e.jsx(u,{variant:"ghost",onClick:y,children:"更换题目"})]}),t.tips.length>0&&e.jsxs("div",{className:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h3",{className:"font-medium text-blue-900 mb-2",children:"写作提示："}),e.jsx("ul",{className:"space-y-1",children:t.tips.map((n,x)=>e.jsxs("li",{className:"text-sm text-blue-800",children:["• ",n]},x))})]})]}),e.jsx(F,{value:r,onChange:i,wordLimit:t==null?void 0:t.wordLimit,placeholder:"开始写作...",autoSave:!0}),g&&e.jsx(v.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"p-4 bg-red-50 border border-red-200 rounded-lg text-red-800",children:g}),e.jsx("div",{className:"flex justify-end",children:e.jsx(u,{size:"lg",onClick:b,disabled:s==="evaluating",icon:s==="evaluating"?e.jsx(T,{className:"w-5 h-5 animate-spin"}):e.jsx(B,{className:"w-5 h-5"}),children:s==="evaluating"?"AI 评分中...":"提交批改"})})]})}export{Z as default};

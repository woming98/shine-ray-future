import{c as S,r as d,j as e,T as k}from"./index-BMvr2Q3z.js";import{C as c,B as N}from"./Button-pqDR0Cbl.js";import{M as R}from"./index-ma8y2xMM.js";import{P as L}from"./pause-BomaQ2dm.js";import{P as T}from"./play-BIQoX-S_.js";import{D as U}from"./download-DcX4mJwW.js";import{U as P}from"./user-CUoQVnOb.js";import{S as A}from"./send-_8Oxq5Rk.js";import{C as D}from"./check-circle-C5mn4RTd.js";import{A as z}from"./alert-circle-t739gKq8.js";import{u as w}from"./useStore-BLrCrgBZ.js";import"./arrow-left-Op4CMYGn.js";import"./pen-tool-aHdskOzV.js";import"./award-CFhIG7Jo.js";import"./middleware-dtXbDlhF.js";import"./useGlobalUser-DSzfZyT8.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=S("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=S("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),O=[{id:"speaking-001",type:"group-discussion",topic:"School Life",prompt:"Discuss with your group: What are the advantages and disadvantages of having longer school hours?",timeLimit:300,tips:["Listen carefully to others' opinions","Express your ideas clearly","Use appropriate connectives","Ask follow-up questions"],difficulty:"medium"},{id:"speaking-002",type:"individual-response",topic:"Technology",prompt:"Do you think social media has more positive or negative effects on teenagers? Explain your answer.",timeLimit:120,tips:["State your opinion clearly","Provide reasons and examples","Use a variety of vocabulary","Speak at a natural pace"],difficulty:"medium"},{id:"speaking-003",type:"presentation",topic:"Environment",prompt:"Give a 2-minute presentation about ways to protect the environment in your daily life.",timeLimit:120,tips:["Organize your ideas logically","Use signposting language","Maintain eye contact","Speak clearly and confidently"],difficulty:"hard"}];function G({onRecordingComplete:s,maxDuration:r=120}){const[i,t]=d.useState(!1),[l,p]=d.useState(!1),[m,n]=d.useState(null),[x,a]=d.useState(0),u=d.useRef(null),f=d.useRef([]),g=d.useRef(null),j=d.useRef(null),v=async()=>{try{const o=await navigator.mediaDevices.getUserMedia({audio:!0}),y=new MediaRecorder(o);u.current=y,f.current=[],y.ondataavailable=h=>{h.data.size>0&&f.current.push(h.data)},y.onstop=()=>{const h=new Blob(f.current,{type:"audio/wav"}),E=URL.createObjectURL(h);n(E),s==null||s(h),o.getTracks().forEach(I=>I.stop())},y.start(),t(!0),a(0),j.current=setInterval(()=>{a(h=>h>=r?(b(),r):h+1)},1e3)}catch(o){console.error("无法访问麦克风:",o),alert("无法访问麦克风，请检查权限设置")}},b=()=>{u.current&&i&&(u.current.stop(),t(!1),j.current&&clearInterval(j.current))},C=()=>{!g.current||!m||(l?g.current.pause():g.current.play(),p(!l))},$=()=>{if(!m)return;const o=document.createElement("a");o.href=m,o.download=`recording-${Date.now()}.wav`,o.click()},M=o=>{const y=Math.floor(o/60),h=o%60;return`${y.toString().padStart(2,"0")}:${h.toString().padStart(2,"0")}`};return e.jsxs(c,{className:"p-6",children:[e.jsx("h3",{className:"font-bold text-gray-900 mb-4",children:"录音控制"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-center gap-4",children:i?e.jsx(N,{size:"lg",onClick:b,icon:e.jsx(q,{className:"w-5 h-5"}),variant:"danger",children:"停止录音"}):e.jsx(N,{size:"lg",onClick:v,icon:e.jsx(R,{className:"w-5 h-5"}),className:"bg-red-500 hover:bg-red-600",children:"开始录音"})}),i&&e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:M(x)}),e.jsx("div",{className:"text-sm text-gray-600",children:"录音中..."})]}),m&&!i&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsx(N,{onClick:C,icon:l?e.jsx(L,{className:"w-5 h-5"}):e.jsx(T,{className:"w-5 h-5"}),children:l?"暂停":"播放"}),e.jsx(N,{variant:"secondary",onClick:$,icon:e.jsx(U,{className:"w-5 h-5"}),children:"下载"})]}),e.jsx("audio",{ref:g,src:m,onEnded:()=>p(!1)})]})]})]})}function V({prompt:s,onResponse:r}){const[i,t]=d.useState([{role:"ai",content:s}]),[l,p]=d.useState(""),m=()=>{if(!l.trim())return;const n={role:"user",content:l};t(x=>[...x,n]),p(""),setTimeout(()=>{const x={role:"ai",content:"This is a placeholder response. In the future, this will use speech recognition and AI to generate real-time responses."};t(a=>[...a,x]),r==null||r(x.content)},1e3)};return e.jsxs(c,{className:"p-6",children:[e.jsx("h3",{className:"font-bold text-gray-900 mb-4",children:"AI 对话"}),e.jsx("div",{className:"space-y-4 mb-4 h-64 overflow-y-auto",children:i.map((n,x)=>e.jsxs("div",{className:`flex items-start gap-3 ${n.role==="user"?"justify-end":"justify-start"}`,children:[n.role==="ai"&&e.jsx("div",{className:"w-8 h-8 rounded-full bg-emerald-100 flex items-center justify-center flex-shrink-0",children:e.jsx(B,{className:"w-5 h-5 text-emerald-600"})}),e.jsx("div",{className:`max-w-[70%] rounded-lg p-3 ${n.role==="user"?"bg-emerald-500 text-white":"bg-gray-100 text-gray-900"}`,children:e.jsx("p",{className:"text-sm",children:n.content})}),n.role==="user"&&e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0",children:e.jsx(P,{className:"w-5 h-5 text-blue-600"})})]},x))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:l,onChange:n=>p(n.target.value),onKeyPress:n=>n.key==="Enter"&&m(),placeholder:"输入回复...",className:"flex-1 px-4 py-2 border border-gray-200 rounded-lg focus:border-emerald-500 focus:outline-none"}),e.jsx(N,{onClick:m,icon:e.jsx(A,{className:"w-4 h-4"}),children:"发送"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"注意：当前为占位实现，后续将集成语音识别和 AI 对话功能"})]})}function F({evaluation:s}){const r=t=>t>=6?"text-emerald-600":t>=4?"text-yellow-600":"text-red-600",i=t=>t>=6?"bg-emerald-50 border-emerald-200":t>=4?"bg-yellow-50 border-yellow-200":"bg-red-50 border-red-200";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsxs(c,{className:`p-4 text-center ${i(s.pronunciation)}`,children:[e.jsx("div",{className:`text-2xl font-bold ${r(s.pronunciation)} mb-1`,children:s.pronunciation}),e.jsx("div",{className:"text-xs text-gray-600",children:"Pronunciation"}),e.jsx("div",{className:"text-xs text-gray-500",children:"發音"})]}),e.jsxs(c,{className:`p-4 text-center ${i(s.fluency)}`,children:[e.jsx("div",{className:`text-2xl font-bold ${r(s.fluency)} mb-1`,children:s.fluency}),e.jsx("div",{className:"text-xs text-gray-600",children:"Fluency"}),e.jsx("div",{className:"text-xs text-gray-500",children:"流暢度"})]}),e.jsxs(c,{className:`p-4 text-center ${i(s.vocabulary)}`,children:[e.jsx("div",{className:`text-2xl font-bold ${r(s.vocabulary)} mb-1`,children:s.vocabulary}),e.jsx("div",{className:"text-xs text-gray-600",children:"Vocabulary"}),e.jsx("div",{className:"text-xs text-gray-500",children:"詞彙"})]}),e.jsxs(c,{className:`p-4 text-center ${i(s.grammar)}`,children:[e.jsx("div",{className:`text-2xl font-bold ${r(s.grammar)} mb-1`,children:s.grammar}),e.jsx("div",{className:"text-xs text-gray-600",children:"Grammar"}),e.jsx("div",{className:"text-xs text-gray-500",children:"語法"})]}),s.interaction&&e.jsxs(c,{className:`p-4 text-center ${i(s.interaction)}`,children:[e.jsx("div",{className:`text-2xl font-bold ${r(s.interaction)} mb-1`,children:s.interaction}),e.jsx("div",{className:"text-xs text-gray-600",children:"Interaction"}),e.jsx("div",{className:"text-xs text-gray-500",children:"互動"})]})]}),e.jsxs(c,{className:`p-6 text-center ${i(s.total/5)}`,children:[e.jsxs("div",{className:`text-4xl font-bold ${r(s.total/5)} mb-2`,children:[s.total,"/35"]}),e.jsx("div",{className:"text-gray-600",children:"总分"})]}),s.feedback.strengths.length>0&&e.jsxs(c,{className:"p-6 bg-emerald-50 border-emerald-200",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[e.jsx(D,{className:"w-5 h-5 text-emerald-600 flex-shrink-0 mt-0.5"}),e.jsx("h3",{className:"font-bold text-emerald-900",children:"优点"})]}),e.jsx("ul",{className:"space-y-2",children:s.feedback.strengths.map((t,l)=>e.jsxs("li",{className:"text-emerald-800 text-sm flex items-start gap-2",children:[e.jsx("span",{className:"text-emerald-600 mt-1",children:"•"}),e.jsx("span",{children:t})]},l))})]}),s.feedback.improvements.length>0&&e.jsxs(c,{className:"p-6 bg-blue-50 border-blue-200",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[e.jsx(z,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),e.jsx("h3",{className:"font-bold text-blue-900",children:"改进建议"})]}),e.jsx("ul",{className:"space-y-2",children:s.feedback.improvements.map((t,l)=>e.jsxs("li",{className:"text-blue-800 text-sm flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-600 mt-1",children:"•"}),e.jsx("span",{children:t})]},l))})]}),s.feedback.pronunciationTips&&s.feedback.pronunciationTips.length>0&&e.jsxs(c,{className:"p-6 bg-purple-50 border-purple-200",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[e.jsx(k,{className:"w-5 h-5 text-purple-600 flex-shrink-0 mt-0.5"}),e.jsx("h3",{className:"font-bold text-purple-900",children:"发音建议"})]}),e.jsx("ul",{className:"space-y-2",children:s.feedback.pronunciationTips.map((t,l)=>e.jsxs("li",{className:"text-purple-800 text-sm flex items-start gap-2",children:[e.jsx("span",{className:"text-purple-600 mt-1",children:"•"}),e.jsx("span",{children:t})]},l))})]}),e.jsx(c,{className:"p-6 bg-gradient-to-br from-emerald-50 to-teal-50 border-emerald-200",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(k,{className:"w-5 h-5 text-emerald-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-900 mb-2",children:"总体评价"}),e.jsx("p",{className:"text-gray-700 leading-relaxed",children:s.overallComment})]})]})})]})}function ne(){const[s,r]=d.useState(null),[i,t]=d.useState(null),{addSpeakingRecording:l,updateRecordingEvaluation:p,recordDailyStudy:m}=w(),n=a=>{r(a),t(null)},x=async a=>{const u=URL.createObjectURL(a),f=Math.floor(a.size/1e3);l({promptId:s.id,audioUrl:u,duration:f>0?f:1}),setTimeout(()=>{const j={pronunciation:5,fluency:6,vocabulary:5,grammar:6,interaction:(s==null?void 0:s.type)==="group-discussion"?5:0,total:(s==null?void 0:s.type)==="group-discussion"?27:22,feedback:{strengths:["发音清晰，能够正确表达意思","使用了适当的连接词"],improvements:["可以增加更多高级词汇","注意语法准确性"],pronunciationTips:["注意单词重音","练习连读技巧"]},overallComment:"整体表现良好，发音清晰，但在词汇使用和语法准确性方面还有提升空间。"};t(j),setTimeout(()=>{const v=w.getState().speakingRecordings,b=v[v.length-1];b&&p(b.id,j)},100)},2e3);const g=s==null?void 0:s.timeLimit;g&&m({minutes:Math.floor(g/60),exercisesCompleted:1,skillsStudied:["speaking"]})};return s?e.jsx("div",{className:"space-y-6",children:e.jsxs(c,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:s.topic}),e.jsx("p",{className:"text-gray-700",children:s.prompt})]}),e.jsx(N,{variant:"secondary",onClick:()=>r(null),children:"返回列表"})]}),s.tips&&s.tips.length>0&&e.jsxs("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h3",{className:"font-medium text-blue-900 mb-2",children:"提示："}),e.jsx("ul",{className:"space-y-1",children:s.tips.map((a,u)=>e.jsxs("li",{className:"text-sm text-blue-800",children:["• ",a]},u))})]}),e.jsx("div",{className:"mb-6",children:e.jsx(G,{onRecordingComplete:x,maxDuration:s.timeLimit})}),s.type==="group-discussion"&&e.jsx("div",{className:"mb-6",children:e.jsx(V,{prompt:s.prompt})}),i&&e.jsx(F,{evaluation:i})]})}):e.jsx("div",{className:"space-y-6",children:e.jsxs(c,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(R,{className:"w-6 h-6 text-emerald-600"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"口语对练"})]}),e.jsx("p",{className:"text-gray-600 mb-6",children:"选择一个口语题目开始练习。支持语音录制、AI 对话和评估反馈。"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:O.map(a=>e.jsxs(c,{onClick:()=>n(a),className:"cursor-pointer hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h3",{className:"font-bold text-gray-900",children:a.topic}),e.jsx("span",{className:"px-2 py-1 bg-emerald-100 text-emerald-700 rounded text-xs",children:a.type==="group-discussion"?"小组讨论":a.type==="individual-response"?"个人回应":"演讲"})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:a.prompt}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[e.jsxs("span",{children:["时长：",Math.floor(a.timeLimit/60)," 分钟"]}),e.jsxs("span",{children:["难度：",a.difficulty]})]})]},a.id))})]})})}export{ne as default};
